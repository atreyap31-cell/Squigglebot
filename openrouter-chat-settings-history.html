<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>OpenRouter Chat</title>

<style>
:root{
  --bg:#0f1117;--panel:#1a1c23;--panel2:#20232c;--border:#2b2f3a;
  --accent:#4f8cff;--accent-soft:#2a3b66;
  --text:#e6e9f0;--muted:#9aa0b4;--error:#ff5c5c;
  --radius:14px;
  --font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Helvetica,Arial,sans-serif;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:var(--font)}
.app{display:flex;flex-direction:column;height:100vh}

/* Header */
header{
  padding:14px 20px;
  border-bottom:1px solid var(--border);
  background:linear-gradient(180deg,var(--panel),var(--panel2));
}
.header-top{display:flex;justify-content:space-between;align-items:center}
h1{font-size:1rem;margin:0;font-weight:600}
.header-actions{display:flex;gap:10px}
.header-actions button{
  background:#11131a;border:1px solid var(--border);color:var(--muted);
  padding:6px 10px;border-radius:8px;cursor:pointer;
}
.header-actions button:hover{color:var(--text)}

/* Settings */
.settings{margin-top:12px;display:flex;gap:12px;flex-wrap:wrap}
.settings.hidden{display:none}
.settings input,.settings select{
  background:#11131a;border:1px solid var(--border);
  color:var(--text);padding:10px 12px;border-radius:10px;
}

/* Chat */
#chat{flex:1;overflow-y:auto;padding:24px 0}
.row{padding:18px 0}
.assistant{background:rgba(255,255,255,0.02)}
.system{background:rgba(255,92,92,0.08);border-left:4px solid var(--error)}
.content{max-width:900px;margin:auto;padding:0 24px;display:flex;gap:16px}
.avatar{
  width:34px;height:34px;border-radius:10px;
  background:var(--accent-soft);display:flex;align-items:center;justify-content:center;
  font-weight:600;font-size:.9rem
}
.user .avatar{background:#3b3f4f}
.text{white-space:pre-wrap;line-height:1.7;font-size:1.02rem}

/* Input */
.input-wrap{
  border-top:1px solid var(--border);
  padding:18px;
  background:linear-gradient(180deg,rgba(15,17,23,0),var(--bg) 30%);
}
form{
  max-width:900px;margin:auto;background:var(--panel);
  border:1px solid var(--border);border-radius:var(--radius);
  display:flex;gap:12px;padding:14px;align-items:flex-end;
}
textarea{
  flex:1;min-height:120px;max-height:260px;resize:none;
  background:#11131a;border:1px solid var(--border);
  color:var(--text);border-radius:12px;padding:14px;
  font-size:1rem;line-height:1.6;
}
button.send{
  background:var(--accent);border:none;color:white;
  padding:14px 18px;border-radius:12px;cursor:pointer;
}
button.send:hover{filter:brightness(1.1)}

/* Typing */
.dots{display:flex;gap:6px;padding-top:6px}
.dot{width:8px;height:8px;border-radius:50%;background:var(--muted);animation:b 1.4s infinite}
.dot:nth-child(2){animation-delay:.2s}.dot:nth-child(3){animation-delay:.4s}
@keyframes b{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}
</style>
</head>

<body>
<div class="app">

<header>
  <div class="header-top">
    <h1>OpenRouter Chat</h1>
    <div class="header-actions">
      <button id="newChat">New Chat</button>
      <button id="deleteChat">Delete Chat</button>
      <button id="toggleSettings">Settings</button>
    </div>
  </div>

  <div class="settings" id="settings">
    <input id="key" type="password" placeholder="OpenRouter API Key">
    <input id="model" value="google/gemini-2.0-flash-lite-preview-02-05:free">
    <select id="historyMode">
      <option value="persist">Chat history ON</option>
      <option value="temp">Temporary chat (no save)</option>
    </select>
  </div>
</header>

<div id="chat"></div>

<div class="input-wrap">
  <form id="form">
    <textarea id="input" placeholder="Type your messageâ€¦"></textarea>
    <button class="send">Send</button>
  </form>
</div>

</div>

<script>
const chat=document.getElementById("chat");
const form=document.getElementById("form");
const input=document.getElementById("input");
const key=document.getElementById("key");
const model=document.getElementById("model");
const settings=document.getElementById("settings");
const toggleSettings=document.getElementById("toggleSettings");
const newChatBtn=document.getElementById("newChat");
const deleteChatBtn=document.getElementById("deleteChat");
const historyMode=document.getElementById("historyMode");

const state={
  key:localStorage.key||"",
  model:localStorage.model||model.value,
  historyMode:localStorage.historyMode||"persist",
  msgs:JSON.parse(localStorage.chatHistory||"[]")
};

key.value=state.key;
model.value=state.model;
historyMode.value=state.historyMode;

toggleSettings.onclick=()=>settings.classList.toggle("hidden");
key.oninput=()=>localStorage.key=state.key=key.value.trim();
model.oninput=()=>localStorage.model=state.model=model.value.trim();
historyMode.onchange=()=>{
  state.historyMode=historyMode.value;
  localStorage.historyMode=state.historyMode;
};

function saveHistory(){
  if(state.historyMode==="persist"){
    localStorage.chatHistory=JSON.stringify(state.msgs);
  }
}

function clearChatUI(){chat.innerHTML=""}

function renderHistory(){
  clearChatUI();
  state.msgs.forEach(m=>add(m.role,m.content,false));
}

function add(role,text,store=true){
  const r=document.createElement("div");
  r.className="row "+role;
  r.innerHTML=`<div class="content"><div class="avatar">${role==="user"?"You":"AI"}</div><div class="text"></div></div>`;
  r.querySelector(".text").textContent=text;
  chat.appendChild(r);
  chat.scrollTop=chat.scrollHeight;
  if(store){
    state.msgs.push({role,content:text});
    saveHistory();
  }
}

function loading(){
  const r=document.createElement("div");
  r.id="load";
  r.className="row assistant";
  r.innerHTML=`<div class="content"><div class="avatar">AI</div><div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`;
  chat.appendChild(r);
  chat.scrollTop=chat.scrollHeight;
}

newChatBtn.onclick=()=>{
  state.msgs=[];
  clearChatUI();
  saveHistory();
};

deleteChatBtn.onclick=()=>{
  if(confirm("Delete this chat permanently?")){
    state.msgs=[];
    localStorage.removeItem("chatHistory");
    clearChatUI();
  }
};

form.onsubmit=async e=>{
  e.preventDefault();
  const t=input.value.trim();
  if(!t)return;
  if(!state.key){add("system","Missing API key",false);return}
  input.value="";
  add("user",t);
  loading();
  try{
    const r=await fetch("https://openrouter.ai/api/v1/chat/completions",{
      method:"POST",
      headers:{
        Authorization:`Bearer ${state.key}`,
        "Content-Type":"application/json",
        "HTTP-Referer":location.href
      },
      body:JSON.stringify({model:state.model,messages:state.msgs})
    });
    const d=await r.json();
    document.getElementById("load").remove();
    const reply=d.choices?.[0]?.message?.content||"No response";
    add("assistant",reply);
  }catch(err){
    document.getElementById("load")?.remove();
    add("system",err.message,false);
  }
};

renderHistory();
</script>
</body>
</html>
